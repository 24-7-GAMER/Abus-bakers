<html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Abu's Bakers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#fff7ec;
      --panel:#fff;
      --accent:#d97706;
      --muted:#6b7280;
      --glass: rgba(255,255,255,0.7);
      --shadow: 0 8px 20px rgba(15,23,42,0.08);
      --gold: #f59e0b;
      --legacy:#0ea5a4;
    }

    /* ===== SPLASH SCREEN ===== */
    #splashScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, #fff7ec 0%, #fef3e0 50%, #fff7ec 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      animation: splashFadeIn 0.8s ease-out forwards;
      overflow: hidden;
    }

    #splashScreen.fade-out {
      animation: splashFadeOut 0.8s ease-in forwards;
    }

    #splashScreen img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      filter: drop-shadow(0 20px 40px rgba(0,0,0,0.15));
      animation: splashImageFloat 3s ease-in-out infinite;
    }

    @keyframes splashFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes splashFadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    @keyframes splashImageFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* Hide main content initially */
    body.loading .container,
    body.loading .floaters {
      opacity: 0;
    }

    /* Prevent scrolling during splash screen */
    body.loading {
      overflow: hidden;
    }
    /* ===== END SPLASH SCREEN ===== */

    html,body{
      height:100%;
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #fff7ec 0%, #fef3e0 60%);
      color:#111827;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      transition: opacity 0.5s ease;
    }

    .floaters{ position:fixed; top:6%; left:4%; font-size:2.6rem; opacity:0.14; transform:rotate(-8deg); pointer-events:none; transition: opacity 0.3s ease; }
    .floaters.right{ right:4%; left:auto; top:70%; transform:rotate(6deg); font-size:2.2rem; opacity:0.12; }

    .container{ max-width:1100px; margin:36px auto; padding:20px; display:grid; grid-template-columns: 1fr 420px; gap:20px; align-items:start; }

    header{ grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:6px; }
    h1{ margin:0; font-size:1.8rem; letter-spacing:-0.02em; }
    .subtitle{ color:var(--muted); font-size:0.95rem; margin-top:4px; }

    .main-card{ background:var(--panel); border-radius:12px; padding:18px; box-shadow:var(--shadow); border:1px solid rgba(15,23,42,0.03); transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .main-card:hover{ transform: translateY(-2px); box-shadow: 0 12px 28px rgba(15,23,42,0.12); }

    .stats{ display:flex; gap:12px; margin-bottom:14px; flex-wrap:wrap; }
    .stat{ background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85)); padding:10px 12px; border-radius:10px; min-width:120px; text-align:left; box-shadow:0 6px 14px rgba(15,23,42,0.04); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
    .stat::before{ content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, var(--accent), var(--gold)); transform: scaleX(0); transition: transform 0.3s ease; }
    .stat:hover{ transform: translateY(-4px); box-shadow:0 12px 24px rgba(15,23,42,0.08); }
    .stat:hover::before{ transform: scaleX(1); }
    .stat strong{display:block; font-size:0.9rem;} .stat span{font-size:1.2rem; color:var(--accent); font-weight:700;}
    .stat.legacy span{ color:var(--legacy); }
    .stat.legacy::before{ background: linear-gradient(90deg, var(--legacy), #06b6d4); }

    #bakeBtn{ width:100%; margin-top:6px; background:linear-gradient(180deg,var(--accent),#b45309); color:white; border:none; padding:18px; border-radius:12px; font-size:1.05rem; cursor:pointer; box-shadow:0 10px 30px rgba(164,94,11,0.18); transition:transform .08s ease, box-shadow .08s ease; position: relative; overflow: hidden; font-weight: 600; letter-spacing: 0.5px; }
    #bakeBtn::before{ content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; border-radius: 50%; background: rgba(255,255,255,0.3); transform: translate(-50%, -50%); transition: width 0.6s ease, height 0.6s ease; }
    #bakeBtn:hover{ transform: translateY(-2px); box-shadow:0 12px 36px rgba(164,94,11,0.25); }
    #bakeBtn:active{ transform:translateY(2px) scale(.995); box-shadow:0 6px 18px rgba(164,94,11,0.12); }
    #bakeBtn:active::before{ width: 300px; height: 300px; }

    .slogan{ margin-top:10px; color:var(--muted); font-size:0.9rem; }

    .side{ display:flex; flex-direction:column; gap:12px; }

    .panel-title{ font-weight:700; margin:0 0 8px 0; }

    .upgrade{ display:flex; justify-content:space-between; align-items:center; gap:10px; padding:10px; border-radius:10px; background:linear-gradient(180deg,#ffffff,#fffaf0); border:1px solid rgba(15,23,42,0.03); transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
    .upgrade .info{ text-align:left; } .upgrade .info .title{ font-weight:700; } .upgrade .info .desc{ color:var(--muted); font-size:0.85rem; margin-top:4px; }
    .upgrade button{ background:var(--gold); border:none; padding:8px 12px; border-radius:8px; color:#1f2937; font-weight:700; cursor:pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2); }
    .upgrade button:hover:not(:disabled){ background:#f59e0b; transform: scale(1.05); box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3); }
    .upgrade button:disabled{ background:#e6e6e6; color:#9ca3af; cursor:not-allowed; box-shadow: none; }

    .unlockable{ display:none; opacity:0; transform:translateY(8px); transition:all .35s cubic-bezier(.2,.9,.2,1); }
    .unlockable.visible{ display:flex; opacity:1; transform:translateY(0); }

    .log{ margin-top:12px; color:var(--muted); font-size:0.9rem; min-height:36px; }

    .progress{ height:10px; background:linear-gradient(90deg,#fff,#fff); border-radius:999px; overflow:hidden; margin-top:12px; border:1px solid rgba(15,23,42,0.03); position: relative; }
    .progress > i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,#fef3c7,#f59e0b); transition:width .3s ease; position: relative; overflow: hidden; }
    .progress > i::after{ content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: shimmer 2s infinite; }
    @keyframes shimmer{ 0%{ transform: translateX(-100%); } 100%{ transform: translateX(100%); } }

    .footer-controls{ display:flex; gap:8px; margin-top:12px; align-items:center; }
    .ghost{ background:transparent; border:1px dashed rgba(15,23,42,0.06); padding:8px 10px; border-radius:8px; color:var(--muted); cursor:pointer; transition: all 0.2s ease; }
    .ghost:hover{ background:rgba(15,23,42,0.03); border-color:rgba(15,23,42,0.12); transform: translateY(-1px); }

    .rebirth-panel{ margin-top:12px; padding:12px; border-radius:10px; background:linear-gradient(180deg,#f0fdfa,#ecfeff); border:1px solid rgba(14,165,164,0.12); transition: all 0.3s ease; }
    .rebirth-panel:hover{ box-shadow: 0 8px 20px rgba(14,165,164,0.15); transform: translateY(-2px); }
    .rebirth-panel button{ background:var(--legacy); color:white; border:none; padding:10px 12px; border-radius:8px; font-weight:700; cursor:pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(14,165,164,0.2); }
    .rebirth-panel button:hover:not(:disabled){ background:#0d9b9a; transform: scale(1.05); box-shadow: 0 4px 12px rgba(14,165,164,0.3); }
    .rebirth-panel button:disabled{ background:#9ad7d5; opacity:0.6; cursor:not-allowed; box-shadow: none; }

    @media (max-width:900px){ .container{ grid-template-columns: 1fr; padding:12px; } .side{ order:2; } }

    @keyframes pop { 0%{ transform:scale(.9); opacity:0; } 60%{ transform:scale(1.06); opacity:1; } 100%{ transform:scale(1); opacity:1; } }
    .pop { animation: pop .45s cubic-bezier(.2,.9,.2,1); }
    .upgrade:hover{ transform:translateY(-4px); transition:transform .12s ease; box-shadow:0 10px 30px rgba(15,23,42,0.06); }
  </style>
</head>
<body class="loading">
  <!-- Splash Screen -->
  <div id="splashScreen">
    <img src="splash.png" alt="Abu's Bakers">
  </div>

  <div class="floaters">ü•ê ü•ñ ü•Ø</div>
  <div class="floaters right">üçû Abu's Bakers</div>

  <div class="container">
    <header>
      <div>
        <h1>Abu's Bakers</h1>
        <div class="subtitle">A cool, slightly sarcastic bakery tycoon where bread pays the bills</div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:700">Owner</div>
        <div style="color:var(--muted)">Abu the Reluctant Baker</div>
      </div>
    </header>

    <main class="main-card">
      <div class="stats">
        <div class="stat"><strong>Funds</strong><span id="funds">0</span></div>
        <div class="stat"><strong>Per Click</strong><span id="perClick">1</span></div>
        <div class="stat"><strong>Passive Income</strong><span id="perSecond">0</span></div>
        <div class="stat legacy"><strong>Legacy Points</strong><span id="legacyPoints">0</span></div>
        <div class="stat legacy"><strong>Rebirths</strong><span id="rebirthCount">0</span></div>
      </div>

      <button id="bakeBtn">BAKE A LOAF üçû</button>
      <div class="slogan" id="slogan">Click to bake. Abu will pretend this was the plan all along.</div>

      <!-- NEW extra click option buttons -->
      <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;">
        <button id="perfectBakeBtn" class="ghost" style="flex:1; border-style:solid;">
          Perfect Bake √ó3 (10s)
        </button>
        <button id="flashSaleBtn" class="ghost" style="flex:1; border-style:solid;">
          Flash Sale +50% (10s)
        </button>
        <button id="vipCateringBtn" class="ghost" style="flex:1; border-style:solid;">
          VIP Catering
        </button>
      </div>

      <div class="progress" title="Bakery reputation"><i id="repBar"></i></div>
      <div class="log" id="log">Tip: Legacy Points give permanent buffs after rebirth.</div>

      <div class="rebirth-panel" id="rebirthPanel">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
          <div style="text-align:left">
            <div style="font-weight:700">Rebirth (Legacy)</div>
            <div style="color:var(--muted); font-size:0.9rem; margin-top:6px;" id="rebirthInfo">
              Reach <strong id="rebirthThreshold">50,000</strong> funds to rebirth and earn Legacy Points.
            </div>
            <div style="color:var(--muted); font-size:0.85rem; margin-top:6px;">
              Each Legacy Point grants <strong id="legacyBuffPct">+5%</strong> permanent boost to click and passive income.
            </div>
          </div>
          <div>
            <button id="rebirthBtn" disabled>Rebirth</button>
          </div>
        </div>
      </div>

      <div class="footer-controls">
        <button class="ghost" id="saveBtn">Save</button>
        <button class="ghost" id="loadBtn">Load</button>
        <button class="ghost" id="resetBtn">Reset</button>
        <div style="flex:1"></div>
        <div style="color:var(--muted); font-size:0.9rem">Version 1.3 (click specials)</div>
      </div>
    </main>

    <aside class="side">
      <div class="main-card">
        <div class="panel-title">Shop</div>

        <div class="upgrade">
          <div class="info"><div class="title">Ergonomic Oven</div><div class="desc">+1 per click. Cost <strong>25</strong></div></div>
          <div><button id="buyOven">Buy (25)</button></div>
        </div>

        <div class="upgrade">
          <div class="info"><div class="title">Apprentice Baker</div><div class="desc">+1 per sec. Cost <strong>80</strong></div></div>
          <div><button id="hireApprentice">Hire (80)</button></div>
        </div>

        <div class="upgrade">
          <div class="info"><div class="title">Delivery Van</div><div class="desc">+6 per sec. Cost <strong>420</strong></div></div>
          <div><button id="buyVan">Buy (420)</button></div>
        </div>

        <div style="margin-top:12px" class="panel-title">Unlockable Departments</div>

        <div id="marketing" class="upgrade unlockable"><div class="info"><div class="title">Marketing Campaign</div><div class="desc">+15 per sec. Cost <strong>1200</strong></div></div><div><button id="buyMarketing">Launch (1200)</button></div></div>

        <div id="pastry" class="upgrade unlockable"><div class="info"><div class="title">Pastry Chef</div><div class="desc">+40 per sec. Cost <strong>4000</strong></div></div><div><button id="hireChef">Hire (4000)</button></div></div>

        <div id="chain" class="upgrade unlockable"><div class="info"><div class="title">Mini Bakery Chain</div><div class="desc">+120 per sec. Cost <strong>15000</strong></div></div><div><button id="buyChain">Open (15000)</button></div></div>

        <div id="u1" class="upgrade unlockable"><div class="info"><div class="title">Window Display</div><div class="desc">+3 per sec. Cost <strong>300</strong></div></div><div><button id="buyU1">Buy (300)</button></div></div>
        <div id="u2" class="upgrade unlockable"><div class="info"><div class="title">Sourdough Lab</div><div class="desc">+8 per sec. Cost <strong>900</strong></div></div><div><button id="buyU2">Open (900)</button></div></div>
        <div id="u3" class="upgrade unlockable"><div class="info"><div class="title">Social Media Intern</div><div class="desc">+4 per sec. Cost <strong>450</strong></div></div><div><button id="buyU3">Hire (450)</button></div></div>
        <div id="u4" class="upgrade unlockable"><div class="info"><div class="title">Automated Dough Mixer</div><div class="desc">+20 per sec. Cost <strong>2500</strong></div></div><div><button id="buyU4">Buy (2500)</button></div></div>
        <div id="u5" class="upgrade unlockable"><div class="info"><div class="title">Celebrity Collab</div><div class="desc">+60 per sec. Cost <strong>8000</strong></div></div><div><button id="buyU5">Launch (8000)</button></div></div>
        <div id="u6" class="upgrade unlockable"><div class="info"><div class="title">Midnight Shift</div><div class="desc">+10 per sec. Cost <strong>1800</strong></div></div><div><button id="buyU6">Start (1800)</button></div></div>
        <div id="u7" class="upgrade unlockable"><div class="info"><div class="title">Bakery Podcast</div><div class="desc">+7 per sec. Cost <strong>700</strong></div></div><div><button id="buyU7">Launch (700)</button></div></div>
        <div id="u8" class="upgrade unlockable"><div class="info"><div class="title">Franchise Consultant</div><div class="desc">+35 per sec. Cost <strong>5200</strong></div></div><div><button id="buyU8">Hire (5200)</button></div></div>
        <div id="u9" class="upgrade unlockable"><div class="info"><div class="title">Artisanal Gluten-Free Line</div><div class="desc">+18 per sec. Cost <strong>3000</strong></div></div><div><button id="buyU9">Launch (3000)</button></div></div>
        <div id="u10" class="upgrade unlockable"><div class="info"><div class="title">Robotic Baker</div><div class="desc">+200 per sec. Cost <strong>50000</strong></div></div><div><button id="buyU10">Install (50000)</button></div></div>

      </div>

      <div class="main-card" style="text-align:left;">
        <div class="panel-title">Bakery Notes</div>
        <div style="color:var(--muted); font-size:0.95rem; margin-top:8px;">
          <ul style="padding-left:18px; margin:6px 0;">
            <li>Funds increase when you bake or buy income sources</li>
            <li>New departments appear as your funds grow</li>
            <li>Save locally to keep your progress</li>
            <li>Press B to bake quickly</li>
            <li>Rebirth to earn Legacy Points and permanent buffs</li>
          </ul>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // ===== SPLASH SCREEN LOGIC =====
    // Handle splash screen fade in/out on page load
    window.addEventListener('load', () => {
      const splashScreen = document.getElementById('splashScreen');
      const body = document.body;
      
      // Wait 2 seconds after fade in completes, then fade out
      setTimeout(() => {
        splashScreen.classList.add('fade-out');
        
        // After fade out animation, remove splash and show main content
        setTimeout(() => {
          splashScreen.style.display = 'none';
          body.classList.remove('loading');
        }, 800); // Match fade-out duration
      }, 2000); // Display time
    });
    // ===== END SPLASH SCREEN LOGIC =====

    // Initialize after DOM is ready to avoid timing issues
    document.addEventListener('DOMContentLoaded', () => {
      try {
        // -------------------------
        // Game state and constants
        // -------------------------
        let funds = 0;
        let basePerClick = 1;   // base click value before legacy multiplier
        let basePerSecond = 0;  // base passive before legacy multiplier

        // Costs and counts
        let costOven = 25, costApprentice = 80, costVan = 420;
        const costMarketing = 1200, costChef = 4000, costChain = 15000;

        const costU = {
          u1: 300, u2: 900, u3: 450, u4: 2500, u5: 8000,
          u6: 1800, u7: 700, u8: 5200, u9: 3000, u10: 50000
        };

        // Inventory counts
        let ovens = 0, apprentices = 0, vans = 0, marketing = 0, chefs = 0, chains = 0;
        let uCounts = { u1:0,u2:0,u3:0,u4:0,u5:0,u6:0,u7:0,u8:0,u9:0,u10:0 };

        // Rebirth / Legacy
        let legacyPoints = 0;
        let rebirthCount = 0;
        const legacyPctPerPoint = 0.05; // 5% per legacy point
        function getLegacyMultiplier(){ return 1 + legacyPoints * legacyPctPerPoint; }

        // reveal thresholds
        const reveal = {
          marketing: 300, pastry: 1200, chain: 6000,
          u1: 200, u2: 800, u3: 350, u4: 2200, u5: 7000,
          u6: 1600, u7: 600, u8: 4800, u9: 2800, u10: 40000
        };

        function currentRebirthThreshold(){
          return 50000 * (1 + rebirthCount * 0.6);
        }

        // Active click bonuses
        let perfectBakeActive = false;
        let flashSaleActive = false;
        let perfectBakeUntil = 0;
        let flashSaleUntil = 0;

        // VIP burst cost and power
        const vipCateringCost = 2500;
        const vipCateringRewardFactor = 4; // gives 4x current passive per second * 10 seconds

        // -------------------------
        // DOM references
        // -------------------------
        const fundsEl = document.getElementById('funds');
        const perClickEl = document.getElementById('perClick');
        const perSecondEl = document.getElementById('perSecond');
        const bakeBtn = document.getElementById('bakeBtn');
        const logEl = document.getElementById('log');
        const repBar = document.getElementById('repBar');

        const buyOvenBtn = document.getElementById('buyOven');
        const hireApprenticeBtn = document.getElementById('hireApprentice');
        const buyVanBtn = document.getElementById('buyVan');
        const buyMarketingBtn = document.getElementById('buyMarketing');
        const hireChefBtn = document.getElementById('hireChef');
        const buyChainBtn = document.getElementById('buyChain');

        const buyU1Btn = document.getElementById('buyU1');
        const buyU2Btn = document.getElementById('buyU2');
        const buyU3Btn = document.getElementById('buyU3');
        const buyU4Btn = document.getElementById('buyU4');
        const buyU5Btn = document.getElementById('buyU5');
        const buyU6Btn = document.getElementById('buyU6');
        const buyU7Btn = document.getElementById('buyU7');
        const buyU8Btn = document.getElementById('buyU8');
        const buyU9Btn = document.getElementById('buyU9');
        const buyU10Btn = document.getElementById('buyU10');

        const marketingDiv = document.getElementById('marketing');
        const pastryDiv = document.getElementById('pastry');
        const chainDiv = document.getElementById('chain');

        const uDivs = {
          u1: document.getElementById('u1'),
          u2: document.getElementById('u2'),
          u3: document.getElementById('u3'),
          u4: document.getElementById('u4'),
          u5: document.getElementById('u5'),
          u6: document.getElementById('u6'),
          u7: document.getElementById('u7'),
          u8: document.getElementById('u8'),
          u9: document.getElementById('u9'),
          u10: document.getElementById('u10')
        };

        const legacyPointsEl = document.getElementById('legacyPoints');
        const rebirthCountEl = document.getElementById('rebirthCount');
        const rebirthBtn = document.getElementById('rebirthBtn');
        const rebirthThresholdEl = document.getElementById('rebirthThreshold');
        const legacyBuffPctEl = document.getElementById('legacyBuffPct');

        const saveBtn = document.getElementById('saveBtn');
        const loadBtn = document.getElementById('loadBtn');
        const resetBtn = document.getElementById('resetBtn');

        // NEW click special buttons
        const perfectBakeBtn = document.getElementById('perfectBakeBtn');
        const flashSaleBtn = document.getElementById('flashSaleBtn');
        const vipCateringBtn = document.getElementById('vipCateringBtn');

        // -------------------------
        // Utility & UI helpers
        // -------------------------
        function fmt(n){
          if (n >= 1e6) return (n/1e6).toFixed(2)+'M';
          if (n >= 1e3) return (n/1e3).toFixed(1)+'k';
          return Math.floor(n);
        }

        function getEffectivePerClick(){
          let value = basePerClick;
          if (perfectBakeActive && Date.now() < perfectBakeUntil){
            value *= 3;
          } else if (perfectBakeActive){
            perfectBakeActive = false;
          }
          return value * getLegacyMultiplier();
        }

        function getEffectivePerSecond(){
          let value = basePerSecond;
          if (flashSaleActive && Date.now() < flashSaleUntil){
            value *= 1.5;
          } else if (flashSaleActive){
            flashSaleActive = false;
          }
          return value * getLegacyMultiplier();
        }

        function updateUI(){
          fundsEl.textContent = fmt(funds);
          perClickEl.textContent = Math.round(getEffectivePerClick() * 100) / 100;
          perSecondEl.textContent = fmt(getEffectivePerSecond());

          buyOvenBtn.disabled = funds < costOven;
          hireApprenticeBtn.disabled = funds < costApprentice;
          buyVanBtn.disabled = funds < costVan;
          buyMarketingBtn.disabled = funds < costMarketing;
          hireChefBtn.disabled = funds < costChef;
          buyChainBtn.disabled = funds < costChain;

          buyU1Btn.disabled = funds < costU.u1;
          buyU2Btn.disabled = funds < costU.u2;
          buyU3Btn.disabled = funds < costU.u3;
          buyU4Btn.disabled = funds < costU.u4;
          buyU5Btn.disabled = funds < costU.u5;
          buyU6Btn.disabled = funds < costU.u6;
          buyU7Btn.disabled = funds < costU.u7;
          buyU8Btn.disabled = funds < costU.u8;
          buyU9Btn.disabled = funds < costU.u9;
          buyU10Btn.disabled = funds < costU.u10;

          // reveal unlockables
          if (funds >= reveal.marketing && !marketingDiv.classList.contains('visible')) { marketingDiv.classList.add('visible','pop'); setTimeout(()=>marketingDiv.classList.remove('pop'),450); log("Marketing unlocked. Abu will reluctantly approve the ad budget."); }
          if (funds >= reveal.pastry && !pastryDiv.classList.contains('visible')) { pastryDiv.classList.add('visible','pop'); setTimeout(()=>pastryDiv.classList.remove('pop'),450); log("Pastry Chef unlocked. Croissants now have opinions."); }
          if (funds >= reveal.chain && !chainDiv.classList.contains('visible')) { chainDiv.classList.add('visible','pop'); setTimeout(()=>chainDiv.classList.remove('pop'),450); log("Mini Bakery Chain unlocked. Abu is suspiciously proud."); }

          for (const k of Object.keys(uDivs)){
            if (funds >= reveal[k] && !uDivs[k].classList.contains('visible')){
              uDivs[k].classList.add('visible','pop');
              setTimeout(()=>uDivs[k].classList.remove('pop'),450);
              const title = uDivs[k].querySelector('.title')?.textContent || k;
              log(`${title} unlocked.`);
            }
          }

          // reputation bar
          const rep = Math.min(100, (funds / 50000) * 100);
          repBar.style.width = rep + '%';

          // rebirth UI
          const threshold = Math.floor(currentRebirthThreshold());
          rebirthThresholdEl.textContent = fmt(threshold);
          legacyPointsEl.textContent = legacyPoints;
          rebirthCountEl.textContent = rebirthCount;
          legacyBuffPctEl.textContent = `+${Math.round(legacyPctPerPoint * 100)}%`;
          rebirthBtn.disabled = funds < threshold;
        }

        function log(message){
          logEl.textContent = message;
        }

        // -------------------------
        // Click & shop actions
        // -------------------------
        // Add click particle effect
        function createClickParticle(x, y) {
          const particle = document.createElement('div');
          particle.style.cssText = `
            position: fixed;
            left: ${x}px;
            top: ${y}px;
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 1000;
            font-size: 1.5rem;
            animation: particleFloat 1s ease-out forwards;
          `;
          particle.textContent = 'üçû';
          document.body.appendChild(particle);
          
          setTimeout(() => particle.remove(), 1000);
        }
        
        // Add particle animation CSS if not exists
        if (!document.querySelector('#particleStyle')) {
          const style = document.createElement('style');
          style.id = 'particleStyle';
          style.textContent = `
            @keyframes particleFloat {
              0% { transform: translateY(0) scale(1); opacity: 1; }
              100% { transform: translateY(-60px) scale(0.5); opacity: 0; }
            }
          `;
          document.head.appendChild(style);
        }

        bakeBtn.addEventListener('click', (e)=>{
          funds += getEffectivePerClick();
          updateUI();
          bakeBtn.animate([{transform:'scale(1)'},{transform:'scale(1.03)'},{transform:'scale(1)'}], {duration:160});
          
          // Create particle at click position
          const rect = bakeBtn.getBoundingClientRect();
          const x = rect.left + rect.width / 2;
          const y = rect.top + rect.height / 2;
          createClickParticle(x, y);
        });

        // Perfect Bake: temporary √ó3 click power for 10 seconds, cost % of funds
        perfectBakeBtn.addEventListener('click', ()=>{
          const cost = Math.max(50, Math.floor(0.08 * funds));
          if (funds < cost){
            log("Perfect Bake needs more funds. Abu glares at the empty tip jar.");
            return;
          }
          funds -= cost;
          perfectBakeActive = true;
          perfectBakeUntil = Date.now() + 10_000;
          log(`Perfect Bake activated! Clicks are spicy for 10 seconds (cost ${fmt(cost)}).`);
          updateUI();
        });

        // Flash Sale: temporary +50% passive income for 10 seconds, cost % of funds
        flashSaleBtn.addEventListener('click', ()=>{
          const cost = Math.max(80, Math.floor(0.12 * funds));
          if (funds < cost){
            log("Flash Sale failed. Abu refuses to discount air.");
            return;
          }
          funds -= cost;
          flashSaleActive = true;
          flashSaleUntil = Date.now() + 10_000;
          log(`Flash Sale started! Passive income boosted for 10 seconds (cost ${fmt(cost)}).`);
          updateUI();
        });

        // VIP Catering: big instant payout based on passive income
        vipCateringBtn.addEventListener('click', ()=>{
          const cost = vipCateringCost;
          if (funds < cost){
            log("VIP Catering requires an actual VIP budget.");
            return;
          }
          funds -= cost;
          const bonus = getEffectivePerSecond() * vipCateringRewardFactor * 10;
          funds += bonus;
          log(`VIP Catering booked! You earned ${fmt(bonus)} from one very fancy event.`);
          updateUI();
        });

        buyOvenBtn.addEventListener('click', ()=>{
          if (funds >= costOven){
            funds -= costOven;
            ovens += 1;
            basePerClick += 1;
            costOven = Math.floor(costOven * 1.5);
            buyOvenBtn.textContent = `Buy (${costOven})`;
            log("Ergonomic Oven purchased. Abu nods approvingly.");
            updateUI();
          }
        });

        hireApprenticeBtn.addEventListener('click', ()=>{
          if (funds >= costApprentice){
            funds -= costApprentice;
            apprentices += 1;
            basePerSecond += 1;
            costApprentice = Math.floor(costApprentice * 1.6);
            hireApprenticeBtn.textContent = `Hire (${costApprentice})`;
            log("An apprentice joins. They ask about overtime.");
            updateUI();
          }
        });

        buyVanBtn.addEventListener('click', ()=>{
          if (funds >= costVan){
            funds -= costVan;
            vans += 1;
            basePerSecond += 6;
            costVan = Math.floor(costVan * 1.7);
            buyVanBtn.textContent = `Buy (${costVan})`;
            log("Delivery Van acquired. It smells faintly of baguettes.");
            updateUI();
          }
        });

        buyMarketingBtn.addEventListener('click', ()=>{
          if (funds >= costMarketing){
            funds -= costMarketing;
            marketing += 1;
            basePerSecond += 15;
            buyMarketingBtn.disabled = true;
            buyMarketingBtn.textContent = "Launched";
            log("Marketing launched. People now know Abu exists.");
            updateUI();
          }
        });

        hireChefBtn.addEventListener('click', ()=>{
          if (funds >= costChef){
            funds -= costChef;
            chefs += 1;
            basePerSecond += 40;
            hireChefBtn.disabled = true;
            hireChefBtn.textContent = "Hired";
            log("Pastry Chef hired. Croissants now file performance reviews.");
            updateUI();
          }
        });

        buyChainBtn.addEventListener('click', ()=>{
          if (funds >= costChain){
            funds -= costChain;
            chains += 1;
            basePerSecond += 120;
            buyChainBtn.disabled = true;
            buyChainBtn.textContent = "Opened";
            log("Mini Bakery Chain opened. Abu contemplates franchising.");
            updateUI();
          }
        });

        buyU1Btn.addEventListener('click', ()=>{ if (funds >= costU.u1){ funds -= costU.u1; uCounts.u1++; basePerSecond += 3; buyU1Btn.disabled = true; buyU1Btn.textContent = "Bought"; log("Window Display installed. People stop and stare."); updateUI(); }});
        buyU2Btn.addEventListener('click', ()=>{ if (funds >= costU.u2){ funds -= costU.u2; uCounts.u2++; basePerSecond += 8; buyU2Btn.disabled = true; buyU2Btn.textContent = "Opened"; log("Sourdough Lab operational. The starter has a PhD."); updateUI(); }});
        buyU3Btn.addEventListener('click', ()=>{ if (funds >= costU.u3){ funds -= costU.u3; uCounts.u3++; basePerSecond += 4; buyU3Btn.disabled = true; buyU3Btn.textContent = "Hired"; log("Social Media Intern hired. Abu's selfies are trending."); updateUI(); }});
        buyU4Btn.addEventListener('click', ()=>{ if (funds >= costU.u4){ funds -= costU.u4; uCounts.u4++; basePerSecond += 20; buyU4Btn.disabled = true; buyU4Btn.textContent = "Installed"; log("Automated Dough Mixer installed. It hums like a small orchestra."); updateUI(); }});
        buyU5Btn.addEventListener('click', ()=>{ if (funds >= costU.u5){ funds -= costU.u5; uCounts.u5++; basePerSecond += 60; buyU5Btn.disabled = true; buyU5Btn.textContent = "Launched"; log("Celebrity Collab launched. Abu signs an autograph reluctantly."); updateUI(); }});
        buyU6Btn.addEventListener('click', ()=>{ if (funds >= costU.u6){ funds -= costU.u6; uCounts.u6++; basePerSecond += 10; buyU6Btn.disabled = true; buyU6Btn.textContent = "Started"; log("Midnight Shift started. The night crew loves bagels."); updateUI(); }});
        buyU7Btn.addEventListener('click', ()=>{ if (funds >= costU.u7){ funds -= costU.u7; uCounts.u7++; basePerSecond += 7; buyU7Btn.disabled = true; buyU7Btn.textContent = "Launched"; log("Bakery Podcast launched. Listeners crave croissant metaphors."); updateUI(); }});
        buyU8Btn.addEventListener('click', ()=>{ if (funds >= costU.u8){ funds -= costU.u8; uCounts.u8++; basePerSecond += 35; buyU8Btn.disabled = true; buyU8Btn.textContent = "Hired"; log("Franchise Consultant hired. Abu receives a spreadsheet."); updateUI(); }});
        buyU9Btn.addEventListener('click', ()=>{ if (funds >= costU.u9){ funds -= costU.u9; uCounts.u9++; basePerSecond += 18; buyU9Btn.disabled = true; buyU9Btn.textContent = "Launched"; log("Gluten-Free Line launched. The critics are confused."); updateUI(); }});
        buyU10Btn.addEventListener('click', ()=>{ if (funds >= costU.u10){ funds -= costU.u10; uCounts.u10++; basePerSecond += 200; buyU10Btn.disabled = true; buyU10Btn.textContent = "Installed"; log("Robotic Baker online. It never takes a break."); updateUI(); }});

        // -------------------------
        // Rebirth (prestige) logic
        // -------------------------
        rebirthBtn.addEventListener('click', ()=>{
          const threshold = Math.floor(currentRebirthThreshold());
          if (funds < threshold) return;
          const gained = Math.max(1, Math.floor(funds / 50000));
          legacyPoints += gained;
          rebirthCount += 1;

          funds = 0;
          basePerClick = 1;
          basePerSecond = 0;

          ovens = apprentices = vans = marketing = chefs = chains = 0;
          uCounts = { u1:0,u2:0,u3:0,u4:0,u5:0,u6:0,u7:0,u8:0,u9:0,u10:0 };
          costOven = 25; costApprentice = 80; costVan = 420;

          buyMarketingBtn.disabled = false; buyMarketingBtn.textContent = "Launch (1200)";
          hireChefBtn.disabled = false; hireChefBtn.textContent = "Hire (4000)";
          buyChainBtn.disabled = false; buyChainBtn.textContent = "Open (15000)";

          for (const k of Object.keys(uDivs)){
            uDivs[k].classList.remove('visible');
            const btn = document.getElementById('buy' + k.toUpperCase());
            if (btn){
              btn.disabled = false;
              btn.textContent = btn.textContent.replace(/(Bought|Opened|Launched|Installed|Hired|Started)/,'').trim();
            }
          }

          perfectBakeActive = false;
          flashSaleActive = false;

          log(`Rebirth complete. You gained ${gained} Legacy Point(s). Permanent buffs applied.`);
          updateUI();
        });

        // -------------------------
        // Passive income loop
        // -------------------------
        setInterval(()=>{
          funds += getEffectivePerSecond() / 10;
          updateUI();
        },100);

        // -------------------------
        // Save / Load / Reset
        // -------------------------
        const saveKey = 'abus_bakers_save_v1.3_click_specials';
        function saveGame(){
          const save = {
            funds, basePerClick, basePerSecond,
            ovens, apprentices, vans, marketing, chefs, chains,
            uCounts, costOven, costApprentice, costVan,
            legacyPoints, rebirthCount
          };
          localStorage.setItem(saveKey, JSON.stringify(save));
          log("Game saved locally. Abu will remember this for now.");
        }

        function loadGame(){
          const raw = localStorage.getItem(saveKey);
          if (!raw){ log("No save found. Abu lost the receipt."); return; }
          try{
            const s = JSON.parse(raw);
            funds = s.funds || 0;
            basePerClick = s.basePerClick || 1;
            basePerSecond = s.basePerSecond || 0;
            ovens = s.ovens || 0; apprentices = s.apprentices || 0; vans = s.vans || 0;
            marketing = s.marketing || 0; chefs = s.chefs || 0; chains = s.chains || 0;
            uCounts = s.uCounts || uCounts;
            costOven = s.costOven || costOven; costApprentice = s.costApprentice || costApprentice; costVan = s.costVan || costVan;
            legacyPoints = s.legacyPoints || 0;
            rebirthCount = s.rebirthCount || 0;

            if (marketing) { buyMarketingBtn.disabled = true; buyMarketingBtn.textContent = "Launched"; marketingDiv.classList.add('visible'); }
            if (chefs) { hireChefBtn.disabled = true; hireChefBtn.textContent = "Hired"; pastryDiv.classList.add('visible'); }
            if (chains) { buyChainBtn.disabled = true; buyChainBtn.textContent = "Opened"; chainDiv.classList.add('visible'); }

            for (const k of Object.keys(uCounts)){
              if (uCounts[k] > 0){
                const btn = document.getElementById('buy' + k.toUpperCase());
                if (btn) { btn.disabled = true; btn.textContent = "Bought"; }
                if (uDivs[k]) uDivs[k].classList.add('visible');
              }
            }

            buyOvenBtn.textContent = `Buy (${costOven})`;
            hireApprenticeBtn.textContent = `Hire (${costApprentice})`;
            buyVanBtn.textContent = `Buy (${costVan})`;
            updateUI();
            log("Save loaded. Abu is back at the oven.");
          }catch(e){
            console.error(e);
            log("Save corrupted. Abu blames the pigeons.");
          }
        }

        function resetGame(){
          if (!confirm("Reset Abu's Bakers? This will clear local progress.")) return;
          localStorage.removeItem(saveKey);
          funds = 0; basePerClick = 1; basePerSecond = 0;
          ovens = apprentices = vans = marketing = chefs = chains = 0;
          uCounts = { u1:0,u2:0,u3:0,u4:0,u5:0,u6:0,u7:0,u8:0,u9:0,u10:0 };
          legacyPoints = 0; rebirthCount = 0;
          costOven = 25; costApprentice = 80; costVan = 420;
          buyMarketingBtn.disabled = false; buyMarketingBtn.textContent = "Launch (1200)";
          hireChefBtn.disabled = false; hireChefBtn.textContent = "Hire (4000)";
          buyChainBtn.disabled = false; buyChainBtn.textContent = "Open (15000)";
          for (const k of Object.keys(uDivs)){
            uDivs[k].classList.remove('visible');
            const btn = document.getElementById('buy' + k.toUpperCase());
            if (btn){
              btn.disabled = false;
              btn.textContent = btn.textContent.replace(/(Bought|Opened|Launched|Installed|Hired|Started)/,'').trim();
            }
          }
          perfectBakeActive = false;
          flashSaleActive = false;

          buyOvenBtn.textContent = `Buy (${costOven})`;
          hireApprenticeBtn.textContent = `Hire (${costApprentice})`;
          buyVanBtn.textContent = `Buy (${costVan})`;
          updateUI();
          log("Reset complete. Abu is starting over with fresh flour and regret.");
        }

        saveBtn.addEventListener('click', saveGame);
        loadBtn.addEventListener('click', loadGame);
        resetBtn.addEventListener('click', resetGame);

        // Auto load if present
        const raw = localStorage.getItem(saveKey);
        if (raw) loadGame(); else updateUI();

        // keyboard shortcut
        window.addEventListener('keydown', (e)=>{ if (e.key.toLowerCase() === 'b') bakeBtn.click(); });

        console.log("Abu's Bakers initialized with click specials.");

      } catch (err) {
        console.error("Initialization error:", err);
        alert("There was an error starting the game. Open the console (F12) and send me the error message and I'll fix it.");
      }
    });
  </script>
</body>
</html>